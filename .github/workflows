name: Team 1 Project12

​

on:

  push:

    branches: [ master ]

  pull_request:

    branches: [ master ]

​

jobs:

​

  build:

​

    runs-on: ubuntu-latest

​

    steps:

    - uses: actions/checkout@v2

    

    - name: Build the Flask API Docker image

      run: |

        cd flask-api

        docker build -t andem/tcmg412-api . 

          

    - name: Launch the service using docker-compose 

      env:

        SLACK_URL: ${{ secrets.SLACK_URL_DEV }}

      run: |

        cd flask-api

        docker-compose up -d 

    

    - name: Verify that the correct containers are running 

      run: docker ps 

​

    - name: Run the API test suite

      run: |

		cd test_suite

		python tests.py --port 4000 --host localhost

​

    - name: Push the new image to Docker Hub

      run: |

        docker login -u ${{ secrets.D_USERNAME }} -p ${{ secrets.D_PASSWORD }}

        docker image tag andem/tcmg412-api andem/tcmg412-api:latest

        docker image tag andem/tcmg412-api andem/tcmg412-api:$(date +%s)

        docker image push --all-tags andem/tcmg412-api
